# PRD: 캠퍼스 감정 날씨 (Campus Emotion Weather) v1.1

## 1. 개요 (Introduction)

### 1.1. 문서 목적
본 문서는 'Campung' 애플리케이션에 도입될 **'캠퍼스 감정 날씨'** 기능의 수정된 요구사항을 정의합니다. v1.0에서 제안된 실시간 분석 방식을 **매시간 주기적으로 최근 1시간의 데이터를 분석하고 누적**하는 방식으로 변경하여 시스템 부하를 줄이고 예측 가능성을 높이는 것을 목표로 합니다.

### 1.2. 문제 정의 (Problem Statement)
사용자는 캠퍼스 커뮤니티의 전반적인 분위기를 직관적으로 파악할 수 있는 기능이 필요합니다. 실시간 집계 방식은 구현 복잡성과 비용 변동성이 크므로, 안정적인 운영을 위해 주기적인 배치(Batch) 처리 방식이 더 적합합니다.

### 1.3. 제안 기능 (Proposed Feature)
**매시간, 최근 1시간 동안 작성된 게시글**을 AI(GPT)로 분석하고, 그 결과를 당일 누적 데이터에 합산합니다. 이 누적된 감성 데이터를 기반으로 커뮤니티의 전반적인 분위기를 **'날씨'**와 **'온도'** 형태로 시각화하여 제공합니다. 데이터는 매일 새벽 5시에 초기화됩니다.

---

## 2. 목표 (Goals and Objectives)

* **핵심 목표:** 사용자가 캠퍼스 커뮤니티의 전반적인 분위기를 쉽고 재미있게 파악하도록 돕는다.
* **세부 목표:**
    * 앱의 첫인상에 감성적이고 흥미로운 요소를 추가하여 사용자 경험(UX)을 향상시킨다.
    * 커뮤니티의 활기, 침체, 주요 감정 상태를 시각적으로 전달하여 사용자의 소속감과 공감대를 증진시킨다.
    * 주기적인 데이터 분석 및 시각화 기능을 안정적으로 운영하고, 데이터 기반 서비스의 초석을 다진다.

---

## 3. 기능 요구사항 (Functional Requirements)

### 3.1. 데이터 수집 및 처리 주기
* **FR-1 (주기적 실행):** 시스템은 **매시간 정각**에 감정 분석 프로세스를 자동으로 실행해야 한다. (예: 06:00, 07:00, 08:00...)
* **FR-2 (데이터 범위):** 매시간 실행 시, **직전 1시간 동안 작성된 모든 게시글(`Content`)**을 분석 대상으로 조회해야 한다. (예: 07:00에 실행 시, 06:00:00 ~ 06:59:59에 작성된 게시글 조회)
* **FR-3 (데이터 초기화):** 모든 누적 감정 점수는 **매일 새벽 5시(05:00)**에 초기화되어야 한다. 즉, 새벽 5시부터 새로운 날의 데이터 집계가 시작된다.

### 3.2. 감정 분석 및 점수 누적
* **FR-4 (감정 분석):** 조회된 각 게시글에 대해, 사전에 정의된 6가지 감정('우울함', '밝음', '신남', '화남', '슬픔', '흥분된') 점수를 1~100점 척도로 측정해야 한다.
* **FR-5 (JSON 응답 형식):** GPT API 호출 시, 비용 효율성과 데이터 파싱의 일관성을 위해 **반드시 JSON 형식으로 응답을 반환**하도록 프롬프트를 설계해야 한다.
    * **GPT 프롬프트 예시:**
        ```
        너는 게시글의 감정을 분석하는 전문가야. 다음 게시글을 읽고 아래 6가지 감정에 대해 각각 1점에서 100점 사이로 점수를 매겨줘. 반드시 JSON 형식으로만 응답해줘.

        [게시글]
        제목: {post.title}
        내용: {post.content}

        [JSON 형식]
        {"우울함": <점수>, "밝음": <점수>, "신남": <점수>, "화남": <점수>, "슬픔": <점수>, "흥분된": <점수>}
        ```
* **FR-6 (점수 누적):** 매시간 분석된 감정 점수는 Redis에 저장된 **당일의 총 누적 점수에 합산**되어야 한다.

### 3.3. '날씨' 및 '온도' 변환 로직
* **FR-7 (날씨 변환):** 누적된 감정 점수 분포에 따라 그날의 '감정 날씨'를 결정해야 한다.
    * **화창함:** '밝음', '신남' 점수가 압도적으로 높을 때.
    * **구름 낌:** 긍정적 감정과 부정적 감정이 혼재하거나, 전반적으로 감정 표현이 적을 때.
    * **완전 구름:** '우울함' 점수가 높고 전반적으로 활동이 저조할 때.
    * **비:** '슬픔' 점수가 유의미하게 높을 때.
    * **천둥번개:** '화남', '흥분된' 점수가 매우 높고 격앙된 분위기일 때.
    * **눈:** 게시글 수가 현저히 적고 '우울함' 또는 중립적 감정이 주를 이룰 때.
* **FR-8 (온도 변환):** 게시글의 활력 수준(에너지)에 따라 '감정 온도'를 결정해야 한다.
    * **온도 상승:** '신남', '흥분된', '화남'과 같이 에너지가 높은 감정 점수가 높을 때.
    * **온도 하강:** '우울함', '슬픔'과 같이 정적인 감정 점수가 높고 게시글 수가 적을 때.

### 3.4. API 제공
* **FR-9:** 클라이언트가 현재 '감정 날씨', '감정 온도', 그리고 누적된 감정 점수 데이터를 조회할 수 있는 API 엔드포인트를 제공해야 한다.
    * **Endpoint:** `GET /api/campus/emotion-weather`
    * **Response Body 예시:**
        ```json
        {
          "success": true,
          "data": {
            "weather": "구름 낌",
            "temperature": 18.2,
            "emotionScores": {
              "화남": 120,
              "흥분된": 150,
              "슬픔": 80,
              "밝음": 310,
              "신남": 280,
              "우울함": 95
            },
            "lastUpdatedAt": "2025-08-26T09:00:15Z"
          }
        }
        ```

---

## 4. 기술 구현 방안 (Technical Implementation)

### 4.1. 아키텍처
* **스케줄러 (`@Scheduled`):**
    * **감정 분석 스케줄러:** 매시간 정각에 실행되도록 cron 표현식(`0 0 * * * *`)을 사용한다. 이 스케줄러는 `CampusEmotionService`의 분석 및 누적 로직을 호출한다.
    * **데이터 초기화 스케줄러:** 매일 새벽 5시에 실행되도록 cron 표현식(`0 0 5 * * *`)을 사용한다. 이 스케줄러는 Redis에 저장된 누적 점수 데이터를 초기화한다.
* **서비스 계층 (`CampusEmotionService`):**
    * `analyzeAndAccumulateHourlyEmotions()`: 스케줄러에 의해 호출되며, 지난 1시간의 게시글 조회, GPT API를 통한 감정 분석, Redis에 결과 누적 로직을 포함한다.
    * `getCampusEmotionWeather()`: API 요청 시 Redis에서 현재 데이터를 조회하여 날씨/온도로 변환 후 반환한다.
* **데이터 저장소:**
    * **MariaDB:** 분석 대상이 되는 원본 게시글(`Content`)을 조회한다.
    * **Redis:** 당일 누적 감정 점수(`emotionScores`), 최종 날씨(`weather`), 온도(`temperature`)를 저장하는 캐시 저장소로 활용한다. API 응답 속도를 높이고 DB 부하를 줄인다.
* **LLM 연동:** 기존 `GPT5FallbackService` 또는 신규 GPT 서비스를 활용한다. JSON 응답을 안정적으로 파싱하기 위해 `ObjectMapper`를 사용한다.

---

## 5. 성공 지표 (Success Metrics)

* **정량적 지표:**
    * 메인 화면 이탈률 감소
    * 기능 관련 API (`/api/campus/emotion-weather`) 호출 횟수
* **정성적 지표:**
    * 사용자 피드백 및 앱 리뷰에서 기능에 대한 긍정적인 언급량
    * 소셜 미디어에서의 기능 언급 및 공유 빈도

---

## 6. 향후 개선 사항 (Future Considerations)

* **감정 세분화:** 기본 6가지 감정 외에 '기대감', '불안함' 등 캠퍼스 생활과 밀접한 감정을 추가하여 분석의 깊이를 더한다.
* **시간대별 분석:** 하루 전체 누적 데이터와 함께, 오전/오후/저녁 등 시간대별 감정 날씨를 제공하여 동적인 변화를 보여준다.
* **비용 최적화:** 기능 안정화 이후, `gpt-5-mini`와 같은 더 저렴한 모델로도 충분한 성능이 나오는지 테스트하여 운영 비용을 최적화한다.